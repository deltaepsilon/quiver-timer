<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">

<link rel="import" href="../digital-clock/digital-clock.html">
<link rel="import" href="../digital-timer/digital-timer.html">
<link rel="import" href="../timer-state/timer-state-behavior.html">
<link rel="import" href="../shared-styles.html">

<link rel="import" href="../timer-behavior/timer-cycles-behavior.html">
<link rel="import" href="../color-wheel.html">

<script src="../../bower_components/lodash/lodash.js"></script>

<dom-module id="timer-playing">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }
      
      #wrapper {
        padding: 1rem;
        top: 4rem;
      }

      #timer-wrapper {
        height: calc(100% - 5rem);
      }
      
      [current-period="0"] .invisible-first-period {
        visibility: none;
      }
      
      .timer {
        margin: 0;
      }
      
      .show-playing {
        display: none;
      }
      
      .show-paused {
        display: none;
      }
      
      [state="playing"] .show-playing {
        display: inherit;
      }
      
      [state="paused"] .show-paused {
        display: inherit;
      }
/*
      .show-stopwatch {
        display: none;
      }

      [type="stopwatch"] .show-stopwatch {
        display: inherit;
      }*/
      .total-seconds {
        position: absolute;
        right: 1rem;
        top: 1rem;
        left: 1rem;
        font-size: 3vh;

        @apply(--layout-horizontal);
      }
      
      .bottom-icons {
        position: absolute;
        right: 1rem;
        bottom: 7rem;
        left: 1rem;
        font-size: 3vh;
      }

      [is-cast] .hide-cast {
        display: none;
      }

      #wrapper[is-cast] {
        padding: 0;
        top: 0;
      }

      [is-cast] #timer-wrapper {
        padding: 3rem;
      }

      [is-cast] .total-seconds {
        right: 5rem;
        top: 5rem;
        left: 5rem;
        font-size: 6vh;
      }

      [is-cast] .bottom-icons {
        bottom: 3rem;
        right: 4rem;
        left: 4rem;
      }

      [is-cast] #icon {
        width: 96px;
        height: 96px;
        margin-left: 3rem;
      }

    </style>
<div id="wrapper" class="pinned" type$="[[period.type]]" current-period$="[[currentPeriod]]" state$="[[state]]" is-cast$="[[isCast]]">
  <div id="timer-wrapper" class$="layout [[position]]">
<digital-timer id="timer" class="timer flex" is-cast="[[isCast]]" global-seconds="[[seconds]]" period-seconds="[[periodSeconds]]" global-cycle-seconds="[[seconds]]"
  global-cycle="[[globalCycle]]" period-cycle-seconds="[[periodCycleSeconds]]" period-cycle="[[periodCycle]]" color-wheel="[[colorWheel]]"></digital-timer>
</div>

<div class="total-seconds">
  <digital-clock total-seconds="[[totalPeriodSeconds]]"></digital-clock>
  <div class="flex"></div>
  <digital-clock total-seconds="[[totalGlobalSeconds]]"></digital-clock>
</div>

<div class="bottom-icons layout horizontal justified center">
  <iron-icon id="icon" icon="[[period.icon]]"></iron-icon>
</div>

<div class="hide-cast">
  <div class="show-playing">
    <div class="bottom-sheet layout horizontal justified center">
      <paper-icon-button class="invisible-first-period" icon="av:skip-previous" on-click="previous"></paper-icon-button>
      <a href$="/timer/[[timerKey]]/paused">
        <paper-fab icon="av:pause"></paper-fab>
      </a>
      <paper-icon-button icon="av:skip-next" on-click="next"></paper-icon-button>
    </div>
  </div>

  <div class="show-paused">
    <div class="bottom-sheet layout horizontal justified center">
      <a href$="/timer/[[timerKey]]/stopped">
        <paper-icon-button icon="av:stop"></paper-icon-button>
      </a>
      <a href$="/timer/[[timerKey]]/playing">
        <paper-fab icon="av:play-arrow"></paper-fab>
      </a>
      <paper-icon-button icon="av:replay" on-click="refresh"></paper-icon-button>
    </div>
  </div>
</div>
</div>
</template>
<script>
  Polymer({
    is: "timer-playing",

    behaviors: [TimerStateBehavior, TimerCyclesBehavior, QuiverColorWheel],

    properties: {
      state: String,
      isCast: Boolean
    },

    observers: ['_state(state)'],

    _state: function (state) {
      if (state == 'stopped') this.clear();
    },

    // Functions
    refresh: function () {
      this.$.timer.refresh();
    },

    clear: function () {
      this.$.timer.emptyChart();
    }
  });
</script>
</dom-module>
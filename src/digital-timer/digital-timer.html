<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../digital-clock/digital-clock.html">
<link rel="import" href="../shared-styles.html">

<script src="../../bower_components/lodash/lodash.js"></script>

<dom-module id="digital-timer">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }
    </style>
    <h3>Display Cycle: [[Title]]</h3>
    <p>Seconds: <digital-clock total-seconds="[[seconds]]"></digital-clock></p>
    <p>Cycle Seconds: <digital-clock total-seconds="[[cycleSeconds]]"></digital-clock></p>
    <p>Cycle Percentages: [[cyclePercentages]]</p>
    <p>Seconds Percentage: [[secondsPercentage]]</p>
    
  </template>
  <script>
    Polymer({
       is: "digital-timer",

       properties: {
         title: String,
         seconds: Number,
         cycleSeconds: Number,
         cycle: Array,
         cyclePercentages: {
           type: Array,
           value: []
         },
         secondsPercentage: {
           type: Number,
           computed: '_secondsPercentage(cycleSeconds, cycle, cycle.splices)'
         }
       },

       // Observers
       observers: [
         '_cyclePercentages(cycle, cycle.splices)'
       ],

       _cyclePercentages: function(cycle) {
         var totalSeconds = cycle.seconds || this.getCycleSeconds(cycle);
         console.log('cyclePercentages', totalSeconds);
         var percentages = cycle.map(function(period) {
           return  Math.round((period.totalSeconds/totalSeconds) * 100) / 100;
         }.bind(this));

         this.splice.apply(this, ['cyclePercentages', 0, this.cyclePercentages.length].concat(percentages));
         console.log('percentages', this.cyclePercentages);
       },

       _secondsPercentage: function(cycleSeconds, cycle) {
         var totalSeconds = cycle.seconds || this.getCycleSeconds(cycle);
         return Math.round((cycleSeconds/totalSeconds) * 100) / 100;
       },

       // Functions
       getCycleSeconds: function(cycle) {
         return cycle.reduce(function(s, period) {
           return s + period.totalSeconds;
         }, 0);
       }

    });
  </script>
</dom-module>
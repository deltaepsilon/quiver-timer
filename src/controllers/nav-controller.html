<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-icons/hardware-icons.html">

<link rel="import" href="../icons.html">

<script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>

<dom-module id="nav-controller">
  <template>
    <style include="iron-flex iron-flex-alignment">
      :host {
        display: block;
      }

      .hidden {
        visibility: hidden;
      }

      .none {
        display: none;
      }

      a {
        color: var(--primary-text-color);
      }

      #title {
        margin: 7px 0 0;
      }
    </style>
<div class="layout horizontal justified" style="position: relative; z-index: 1;">
<a href="/timers" class$="[[arrowClass]]">
  <paper-icon-button icon="arrow-back"></paper-icon-button>
</a>
<paper-icon-button class$="[[castClass]]" icon="hardware:cast" on-click="cast"></paper-icon-button>
<h3 id="title">[[pageTitle]]</h3>
<div class="flex layout horizontal end-justified">
  <button is="google-cast-button"></button>
  <paper-icon-button class$="[[exitClass]]" icon="extended:exit" on-click="logout"></paper-icon-button>
  <paper-icon-button class$="[[settingsClass]]" icon="settings" on-click="openSettings"></paper-icon-button>
</div>

</div>
</template>
<script>
  Polymer({
    is: "nav-controller",

    properties: {
      page: String,
      tail: Object,
      pageTitle: {
        type: String,
        computed: '_pageTitle(page)'
      },
      arrowClass: {
        type: Boolean,
        computed: '_arrowClass(page, tail)'
      },
      castClass: {
        type: Boolean,
        computed: '_castClass(page, tail)'
      },
      exitClass: {
        type: Boolean,
        computed: '_settingsClass(page)'
      },
      settingsClass: {
        type: Boolean,
        computed: '_settingsClass(page)'
      }
    },

    attached: function () {
      window.__onGCastApiAvailable = function (isAvailable) {
        if (isAvailable) {
          cast.framework.CastContext.getInstance().setOptions({
            receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
            autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
          });

        }
      }
    },

    _pageTitle: function(page) {
      if (page == 'timers') return 'Timers';
      return ''
    },

    _arrowClass: function (page, tail) {
      var showPages = ['timer', 'configure', 'fourohfour'];
      if (tail.path.match(/playing/)) return 'none';
      return !!~showPages.indexOf(page) ? 'show' : 'hidden';
    },

    _castClass: function (page, tail) {
      var showPages = ['timer'];
      if (tail.path.match(/stopped/)) return 'none';
      return !!~showPages.indexOf(page) ? 'show' : 'none';
    },

    _settingsClass: function (page) {
      var showPages = ['timers', 'timer', 'configure'];
      return !!~showPages.indexOf(page) ? 'show' : 'hidden';
    },

    openSettings: function () {
      this.fire('openSettings');
    },

    logout: function () {
      this.fire('logout');
    },

    cast: function () {
      console.log('cast');
    },

    getCastSession: function() {
      return cast.framework.CastContext.getInstance().getCurrentSession();
    }
  });
</script>
</dom-module>
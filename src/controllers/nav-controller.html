<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">

<link rel="import" href="../icons.html">

<dom-module id="nav-controller">
  <template>
    <style include="iron-flex iron-flex-alignment">
      :host {
        display: block;
      }

      .hidden {
        display: none;
      }

      .none {
        display: none;
      }

      a {
        color: var(--primary-text-color);
      }

      #title {
        margin: 0;
        padding: 6px 10px 0;
      }

      #title.bottom-right {
        position: fixed;
        bottom: 110px;
        right: 26px;
      }

      paper-icon-button[casting] {
        color: var(--app-primary-color);
      }
    </style>
<div class="layout horizontal justified" style="position: relative; z-index: 1;">
<a href="/timers" class$="[[arrowClass]]" style="margin-left: -2px;">
  <paper-icon-button icon="arrow-back"></paper-icon-button>
</a>
<h3 id="title" class$="[[titleClass]]">[[pageTitle]]</h3>
<div class="flex layout horizontal end-justified">
  <template is="dom-if" if="[[uid]]">
    <paper-icon-button class$="[[exitClass]]" casting$="[[casting]]" icon="social:share" on-click="openCast"></paper-icon-button>
  </template>
  <paper-icon-button class$="[[exitClass]]" icon="extended:exit" on-click="logout"></paper-icon-button>
  <paper-icon-button class$="[[settingsClass]]" icon="settings" on-click="openSettings"></paper-icon-button>
</div>

</div>
</template>
<script>
  Polymer({
    is: "nav-controller",

    properties: {
      page: String,
      tail: Object,
      uid: String,
      casting: {
        type: Boolean,
        value: false
      },
      pageTitle: {
        type: String,
        computed: '_pageTitle(page, tail)'
      },
      titleClass: {
        type: String,
        computed: '_titleClass(page, tail)'
      },
      arrowClass: {
        type: String,
        computed: '_arrowClass(page, tail)'
      },
      exitClass: {
        type: String,
        computed: '_settingsClass(page)'
      },
      settingsClass: {
        type: String,
        computed: '_settingsClass(page)'
      }
    },

    // Observers
    _pageTitle: function (page, tail) {
      if (page == 'timers') return 'Timers';
      if (page == 'timer' && !tail.path.match(/stopped/)) return location.hostname;
      return ''
    },

    _titleClass: function(page, tail) {
      if (page == 'timer' && !tail.path.match(/stopped/)) return 'bottom-right';
    },

    _arrowClass: function (page, tail) {
      var showPages = ['timer', 'configure', 'fourohfour'];
      // if (tail.path.match(/playing/)) return 'none';
      return !!~showPages.indexOf(page) ? 'show' : 'hidden';
    },

    _settingsClass: function (page) {
      var showPages = ['timers', 'timer', 'configure'];
      return !!~showPages.indexOf(page) ? 'show' : 'hidden';
    },

    openSettings: function () {
      this.fire('openSettings');
    },

    openCast: function() {
      this.fire('openDialog', {id: 'castDialog'})
    },

    logout: function () {
      this.fire('logout');
    }
  });
</script>
</dom-module>
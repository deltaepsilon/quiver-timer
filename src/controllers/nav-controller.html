<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">

<link rel="import" href="../icons.html">

<dom-module id="nav-controller">
  <template>
    <style include="iron-flex iron-flex-alignment">
      :host {
        display: block;
      }

      .hidden {
        display: none;
      }

      .show {
        display: inherit !important;
      }

      .none {
        display: none;
      }

      a {
        color: var(--primary-text-color);
      }

      #title {
        margin: 0;
        padding: 6px 10px 0;
      }

      #title.bottom-right {
        position: fixed;
        bottom: 110px;
        right: 26px;
      }

      paper-icon-button[casting] {
        color: var(--app-primary-color);
      }
    </style>
<div class="layout horizontal justified" style="position: relative; z-index: 1;">
<a href="/timers" class$="[[arrowClass]]" style="margin-left: -2px;">
  <paper-icon-button icon="arrow-back"></paper-icon-button>
</a>
<a class$="hidden [[adminClass]]" href="/admin">
  <paper-icon-button icon="build"></paper-icon-button>
</a>
<h3 id="title" class$="[[titleClass]]">[[pageTitle]]</h3>
<div class="flex layout horizontal end-justified">
  <paper-icon-button class$="hidden [[castClass]]" casting$="[[casting]]" icon="social:share" on-click="openCast"></paper-icon-button>
  <paper-icon-button class$="hidden [[settingsClass]]" icon="settings" on-click="openSettings"></paper-icon-button>
  <paper-icon-button class$="hidden [[exitClass]]" icon="power-settings-new" on-click="logout"></paper-icon-button>
</div>

</div>
</template>
<script>
  Polymer({
    is: "nav-controller",

    properties: {
      page: String,
      tail: Object,
      uid: {
        type: String,
        value: ''  
      },
      isAdmin: {
        type: Boolean,
        value: false  
      },
      connected: {
        type: Boolean,
        value: false
      },
      casting: {
        type: Boolean,
        value: false
      },
      pageTitle: {
        type: String,
        computed: '_pageTitle(page, tail)'
      },
      titleClass: {
        type: String,
        computed: '_titleClass(page, tail)'
      },
      arrowClass: {
        type: String,
        computed: '_arrowClass(page, tail)'
      },
      loggedInPages: {
        type: Array,
        value: ['admin', 'timers', 'timer', 'configure']
      },
      isLoggedInPage: {
        type: Boolean,
        computed: '_isLoggedInPage(loggedInPages, page)'
      },
      isTimerPage: {
        type: Boolean,
        computed: '_isTimerPage(page)'
      },
      isPublicPage: {
        type: Boolean,
        computed: '_isPublicPage(page)'
      },
      isAdminPage: {
        type: Boolean,
        computed: '_isAdminPage(page)'
      },
      exitClass: {
        type: String,
        computed: '_showHide(isLoggedInPage, connected)'
      },
      settingsClass: {
        type: String,
        computed: '_showHide(isLoggedInPage)'
      },
      castClass: {
        type: String,
        computed: '_showHide(isLoggedInPage, isTimerPage, uid, connected)'
      },
      adminClass: {
        type: String,
        computed: '_showHide(isLoggedInPage, isAdmin, isPublicPage)'
      }
    },

    // Observers
    _pageTitle: function (page, tail) {
      if (page == 'timers') return 'Timers';
      if (page == 'timer' && !tail.path.match(/stopped/)) return location.hostname;
      return ''
    },

    _titleClass: function(page, tail) {
      if (page == 'timer' && !tail.path.match(/stopped/)) return 'bottom-right';
    },

    _arrowClass: function (page, tail) {
      var showPages = ['admin', 'timer', 'configure', 'fourohfour'];
      // if (tail.path.match(/playing/)) return 'none';
      return !!~showPages.indexOf(page) ? 'show' : 'hidden';
    },


    _isLoggedInPage: function(pages, page) {
      return !!~pages.indexOf(page);
    },

    _isTimerPage: function(page) {
      return page == 'timer';
    },

    _isAdminPage: function(page) {
      return page == 'admin';
    },

    _isPublicPage: function(page) {
      return page != 'admin';
    },

    _showHide: function() {
      var args = Array.prototype.slice.call(arguments);
      var i = args.length;

      if (!args.length) return 'hidden';

      while (i--) {
        if (!args[i]) return 'hidden';
      }
      return 'show';
    },

    openSettings: function () {
      this.fire('openSettings');
    },

    openCast: function() {
      this.fire('openDialog', {id: 'castDialog'})
    },

    logout: function () {
      this.fire('logout');
    }
  });
</script>
</dom-module>
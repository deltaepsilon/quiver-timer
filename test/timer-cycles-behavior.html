<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

  <title>my-view1</title>

  <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../bower_components/web-component-tester/browser.js"></script>

  <!-- Import the element to test -->
  <link rel="import" href="../src/timer-behavior/timer-cycles-behavior.html">
</head>

<body>
  <test-fixture id="basic">
    <template>
    </template>
  </test-fixture>

  <script>
      suite('TimerCyclesBehavior tests', function() {
        var home;

        setup(function() {
          home = fixture('basic');
        });

        var threeCycles =  {
          "name": "Three Cycles +",
          "periods": [
            {
              "name": "Prepare",
              "minutes": 0,
              "seconds": 0,
              "totalSeconds": 0,
              "icon": "av:snooze",
              "type": "prepare",
              "isPrepare": true,
              "timestamp": 1479830521617,
              "displayIcon": "av:snooze",
              "color": 0
            },
            {
              "name": "Pushpress",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480133542777,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 1
            },
            {
              "name": "Rest",
              "seconds": 30,
              "minutes": 0,
              "totalSeconds": 30,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1480133555967,
              "displayIcon": "av:pause-circle-outline",
              "selected": false,
              "color": 2
            },
            {
              "name": "Deadlift",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480133562570,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 3
            },
            {
              "name": "Rest",
              "seconds": 30,
              "minutes": 0,
              "totalSeconds": 30,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1480133572650,
              "displayIcon": "av:pause-circle-outline",
              "selected": false,
              "color": 4
            },
            {
              "name": "Pushpress",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480133542777,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 5
            },
            {
              "name": "Rest",
              "seconds": 30,
              "minutes": 0,
              "totalSeconds": 30,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1480133555967,
              "displayIcon": "av:pause-circle-outline",
              "selected": false,
              "color": 6
            },
            {
              "name": "Deadlift",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480133562570,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 7
            },
            {
              "name": "Rest",
              "seconds": 30,
              "minutes": 0,
              "totalSeconds": 30,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1480133572650,
              "displayIcon": "av:pause-circle-outline",
              "selected": false,
              "color": 8
            },
            {
              "name": "Pushpress",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480133542777,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 9
            },
            {
              "name": "Rest",
              "seconds": 30,
              "minutes": 0,
              "totalSeconds": 30,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1480133555967,
              "displayIcon": "av:pause-circle-outline",
              "selected": false,
              "color": 10
            },
            {
              "name": "Deadlift",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480133562570,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 11
            },
            {
              "name": "Rest",
              "seconds": 30,
              "minutes": 0,
              "totalSeconds": 30,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1480133572650,
              "displayIcon": "av:pause-circle-outline",
              "selected": false,
              "color": 12
            },
            {
              "name": "Rower AMRAP",
              "seconds": 0,
              "minutes": 10,
              "totalSeconds": 600,
              "icon": "custom:stopwatch",
              "type": "stopwatch",
              "isStopwatch": true,
              "timestamp": 1480133595353,
              "displayIcon": "custom:stopwatch",
              "color": 13
            }
          ],
          "totalSeconds": 1140,
          "updated": 1480133628510
        };
        var subCycleEmom = {
          "name": "Sub-cycle EMOM",
          "periods": [
            {
              "name": "Prepare",
              "minutes": 0,
              "seconds": 10,
              "totalSeconds": 10,
              "icon": "av:snooze",
              "type": "prepare",
              "isPrepare": true,
              "timestamp": 1480175249651,
              "displayIcon": "av:snooze",
              "color": 0
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 4,
              "totalSeconds": 240,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175267968,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 1
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 4,
              "totalSeconds": 240,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175267968,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 2
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 4,
              "totalSeconds": 240,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175267968,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 3
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 4,
              "totalSeconds": 240,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175267968,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 4
            },
            {
              "name": "Rest",
              "seconds": 30,
              "minutes": 5,
              "totalSeconds": 330,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1480175282354,
              "displayIcon": "av:pause-circle-outline",
              "selected": false,
              "color": 5
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 4,
              "totalSeconds": 240,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175267968,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 6
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 4,
              "totalSeconds": 240,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175267968,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 7
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 4,
              "totalSeconds": 240,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175267968,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 8
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 4,
              "totalSeconds": 240,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175267968,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 9
            },
            {
              "name": "Rest",
              "seconds": 30,
              "minutes": 5,
              "totalSeconds": 330,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1480175282354,
              "displayIcon": "av:pause-circle-outline",
              "selected": false,
              "color": 10
            },
            {
              "name": "Stopwatch",
              "seconds": 0,
              "minutes": 10,
              "totalSeconds": 600,
              "icon": "custom:stopwatch",
              "type": "stopwatch",
              "isStopwatch": true,
              "timestamp": 1480175315436,
              "displayIcon": "custom:stopwatch",
              "color": 11
            }
          ],
          "totalSeconds": 3190,
          "updated": 1480175336717
        };
        var tenMinuteEmom = {
          "name": "10m EMOM",
          "periods": [
            {
              "name": "Prepare",
              "minutes": 0,
              "seconds": 10,
              "totalSeconds": 10,
              "icon": "av:snooze",
              "type": "prepare",
              "isPrepare": true,
              "timestamp": 1480175206641,
              "displayIcon": "av:snooze",
              "color": 0
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175212131,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 1
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175217832,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 2
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175218600,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 3
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175212131,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 4
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175217832,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 5
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175218600,
              "displayIcon": "hourglass-empty",
              "selected": false,
              "color": 6
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175235736,
              "displayIcon": "hourglass-empty",
              "color": 7
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175237358,
              "displayIcon": "hourglass-empty",
              "color": 8
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175238367,
              "displayIcon": "hourglass-empty",
              "color": 9
            },
            {
              "name": "Work",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1480175238851,
              "displayIcon": "hourglass-empty",
              "color": 10
            }
          ],
          "totalSeconds": 610,
          "updated": 1480175249394
        };
        var fiveByFive = {
          "name": "5x5 New Names",
          "periods": [
            {
              "name": "Prepare",
              "minutes": 0,
              "seconds": 0,
              "totalSeconds": 0,
              "icon": "av:snooze",
              "type": "prepare",
              "isPrepare": true,
              "timestamp": 1481251599457,
              "displayIcon": "av:snooze"
            },
            {
              "name": "One",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1481564878923,
              "displayIcon": "hourglass-empty",
              "selected": false
            },
            {
              "name": "Rest",
              "seconds": 0,
              "minutes": 3,
              "totalSeconds": 180,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1481564882101,
              "displayIcon": "av:pause-circle-outline",
              "selected": false
            },
            {
              "name": "Two",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1481564878923,
              "displayIcon": "hourglass-empty",
              "selected": false
            },
            {
              "name": "Rest",
              "seconds": 0,
              "minutes": 3,
              "totalSeconds": 180,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1481564882101,
              "displayIcon": "av:pause-circle-outline",
              "selected": false
            },
            {
              "name": "Three",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1481564878923,
              "displayIcon": "hourglass-empty",
              "selected": false
            },
            {
              "name": "Rest",
              "seconds": 0,
              "minutes": 3,
              "totalSeconds": 180,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1481564882101,
              "displayIcon": "av:pause-circle-outline",
              "selected": false
            },
            {
              "name": "Four",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1481564878923,
              "displayIcon": "hourglass-empty",
              "selected": false
            },
            {
              "name": "Rest",
              "seconds": 0,
              "minutes": 3,
              "totalSeconds": 180,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1481564882101,
              "displayIcon": "av:pause-circle-outline",
              "selected": false
            },
            {
              "name": "Five",
              "seconds": 0,
              "minutes": 1,
              "totalSeconds": 60,
              "icon": "hourglass-empty",
              "type": "work",
              "isWork": true,
              "timestamp": 1481564878923,
              "displayIcon": "hourglass-empty",
              "selected": false
            },
            {
              "name": "Rest",
              "seconds": 0,
              "minutes": 3,
              "totalSeconds": 180,
              "icon": "av:pause-circle-outline",
              "type": "rest",
              "isRest": true,
              "timestamp": 1481564882101,
              "displayIcon": "av:pause-circle-outline",
              "selected": false
            }
          ],
          "totalSeconds": 1200,
          "updated": 1481565033147
        };

        test('5x5', function() { // Test nested sub-cycles. Should find the smallest indivisible sub-cycle.
          var cycles = TimerCyclesBehavior._periodCycles(fiveByFive.periods);
          assert.equal(6, cycles.length);
          cycles.forEach(function(cycle, i) {
            if (i == 0) assert.equal(1, cycle.length);
            else assert.equal(2, cycle.length); 
          });
        });

        test('Global Cycles', function() {
          var subCycleEmomCycles = TimerCyclesBehavior._globalCycles(subCycleEmom.periods);
          var threeCyclesCycles = TimerCyclesBehavior._globalCycles(threeCycles.periods);
          var tenMinuteEmomCycles = TimerCyclesBehavior._globalCycles(tenMinuteEmom.periods);
          assert.equal(1, subCycleEmomCycles.length);
          assert.equal(1, threeCyclesCycles.length);
          assert.equal(1, tenMinuteEmomCycles.length);
          assert.equal(subCycleEmom.periods.length, subCycleEmomCycles[0].length);
          assert.equal(threeCycles.periods.length, threeCyclesCycles[0].length);
          assert.equal(tenMinuteEmom.periods.length, tenMinuteEmomCycles[0].length);
        });

        test('Sub-cycle EMOM', function() {
          var cycles = TimerCyclesBehavior._periodCycles(subCycleEmom.periods);
          assert.equal(4, cycles.length);
          assert.equal(1, cycles[0].length);
          assert.equal(5, cycles[1].length);
          assert.equal(5, cycles[2].length);
          assert.equal(1, cycles[3].length);
        });

        test('Three Cycles', function() {
          var cycles = TimerCyclesBehavior._periodCycles(threeCycles.periods);
          assert.equal(8, cycles.length);
          assert.equal(1, cycles[0].length);
          assert.equal(2, cycles[1].length);
          assert.equal(2, cycles[2].length);
          assert.equal(2, cycles[3].length);
          assert.equal(2, cycles[4].length);
          assert.equal(2, cycles[5].length);
          assert.equal(2, cycles[6].length);
          assert.equal(1, cycles[7].length);
        });

        test('10 Minute EMOM', function() {
          var cycles = TimerCyclesBehavior._periodCycles(tenMinuteEmom.periods);
          assert.equal(11, cycles.length);
          cycles.forEach(function(cycle) {
            assert.equal(1, cycle.length);  
          });
        });

      });
    </script>
</body>

</html>